{% doc %}
  Velox Image Component
  Renderiza im치genes responsivas con lazy loading y srcset optimizado.

  @param {image} image - La imagen a renderizar
  @param {string} [url] - URL de destino opcional
  @param {string} [class] - Clases CSS adicionales
  @param {number} [width] - Ancho m치ximo de la imagen
  @param {number} [height] - Alto m치ximo (para aspect ratio fijo)
  @param {string} [crop] - Posici칩n de recorte: center, top, bottom, left, right
  @param {string} [aspect] - Aspect ratio: square, product (3/4), wide (4/3), video (16/9)
  @param {boolean} [lazy] - Lazy loading (default: true)
  @param {boolean} [priority] - High priority for LCP images (default: false)
  @param {string} [alt] - Alt text personalizado
  @param {string} [sizes] - Sizes attribute para srcset

  @example
  {% render 'image', image: product.featured_image %}
  {% render 'image', image: product.featured_image, aspect: 'product', lazy: true %}
  {% render 'image', image: hero_image, priority: true, lazy: false %}
  {% render 'image',
    image: product.featured_image,
    url: product.url,
    width: 800,
    aspect: 'product',
    crop: 'center'
  %}
{% enddoc %}

{% liquid
  assign image_alt = alt | default: image.alt | escape
  assign image_crop = crop | default: 'center'

  # Priority images: disable lazy loading and set high fetchpriority
  if priority
    assign lazy_load = false
    assign fetch_priority = 'high'
  else
    assign lazy_load = lazy | default: true
    assign fetch_priority = nil
  endif

  unless height
    assign width = width | default: image.width | at_most: 1600
  endunless

  if url
    assign wrapper = 'a'
  else
    assign wrapper = 'div'
  endif

  # Determinar aspect ratio class
  case aspect
    when 'square'
      assign aspect_class = 'tw-aspect-square'
    when 'product'
      assign aspect_class = 'tw-aspect-product'
    when 'wide'
      assign aspect_class = 'tw-aspect-product-wide'
    when 'video'
      assign aspect_class = 'tw-aspect-video'
    else
      assign aspect_class = ''
  endcase

  # Sizes por defecto si no se especifica
  assign image_sizes = sizes | default: '(min-width: 1200px) 400px, (min-width: 750px) 50vw, 100vw'
%}

<{{ wrapper }}
  class="tw-block tw-relative tw-overflow-hidden tw-w-full {{ aspect_class }} {{ class }}"
  {% if url %}href="{{ url }}"{% endif %}
>
  {% if fetch_priority %}
    {{ image
      | image_url: width: width, height: height, crop: image_crop
      | image_tag:
        class: 'tw-w-full tw-h-full tw-object-cover tw-object-center',
        loading: 'eager',
        fetchpriority: fetch_priority,
        alt: image_alt,
        sizes: image_sizes,
        widths: '165, 360, 535, 750, 1100, 1500'
    }}
  {% else %}
    {{ image
      | image_url: width: width, height: height, crop: image_crop
      | image_tag:
        class: 'tw-w-full tw-h-full tw-object-cover tw-object-center',
        loading: lazy_load | default: 'lazy',
        alt: image_alt,
        sizes: image_sizes,
        widths: '165, 360, 535, 750, 1100, 1500'
    }}
  {% endif %}
</{{ wrapper }}>
