{% comment %}
  Size Chart Modal
  Shows size guide with customizable table and image

  Uso: {% render 'size-chart-modal', block: block %}
{% endcomment %}

{%- comment -%} Modal Trigger Button {%- endcomment -%}
<button
  type="button"
  class="tw-inline-flex tw-items-center tw-gap-1.5 tw-text-sm tw-text-velox-600 hover:tw-text-velox-900 tw-underline tw-underline-offset-2"
  data-size-chart-trigger
  aria-haspopup="dialog"
  {{ block.shopify_attributes }}
>
  {% render 'icon', name: 'rulers', class: 'tw-w-4 tw-h-4' %}
  {{ block.settings.button_text | default: 'Size Guide' }}
</button>

{%- comment -%} Modal {%- endcomment -%}
<div 
  class="tw-fixed tw-inset-0 tw-z-50 tw-hidden"
  data-size-chart-modal
  role="dialog"
  aria-modal="true"
  aria-labelledby="size-chart-title"
>
  {%- comment -%} Backdrop {%- endcomment -%}
  <div 
    class="tw-absolute tw-inset-0 tw-bg-black/50 tw-backdrop-blur-sm"
    data-size-chart-overlay
  ></div>

  {%- comment -%} Modal Content {%- endcomment -%}
  <div class="tw-absolute tw-top-1/2 tw-left-1/2 tw--translate-x-1/2 tw--translate-y-1/2 tw-w-full tw-max-w-2xl tw-max-h-[90vh] tw-overflow-y-auto tw-mx-4">
    <div class="tw-bg-white tw-rounded-xl tw-shadow-2xl tw-p-6 tw-relative">
      {%- comment -%} Close Button {%- endcomment -%}
      <button 
        type="button"
        class="tw-absolute tw-top-4 tw-right-4 tw-w-8 tw-h-8 tw-flex tw-items-center tw-justify-center tw-rounded-full tw-bg-velox-100 hover:tw-bg-velox-200 tw-transition-colors"
        data-size-chart-close
        aria-label="Close"
      >
        {% render 'icon', name: 'x', class: 'tw-w-5 tw-h-5' %}
      </button>

      {%- comment -%} Title {%- endcomment -%}
      <h2 id="size-chart-title" class="tw-text-xl tw-font-bold tw-text-velox-900 tw-mb-4 tw-pr-10">
        {{ block.settings.title | default: 'Size Guide' }}
      </h2>

      {%- comment -%} Description {%- endcomment -%}
      {% if block.settings.description != blank %}
        <p class="tw-text-velox-600 tw-mb-6">{{ block.settings.description }}</p>
      {% endif %}

      {%- comment -%} Size Chart Image {%- endcomment -%}
      {% if block.settings.chart_image != blank %}
        <div class="tw-mb-6">
          {{ block.settings.chart_image | image_url: width: 800 | image_tag: 
            class: 'tw-w-full tw-h-auto tw-rounded-lg',
            loading: 'lazy'
          }}
        </div>
      {% endif %}

      {%- comment -%} Size Table {%- endcomment -%}
      {% if block.settings.show_table %}
        <div class="tw-overflow-x-auto">
          <table class="tw-w-full tw-text-sm">
            <thead>
              <tr class="tw-bg-velox-50">
                <th class="tw-px-4 tw-py-3 tw-text-left tw-font-medium tw-text-velox-700">Size</th>
                <th class="tw-px-4 tw-py-3 tw-text-left tw-font-medium tw-text-velox-700">Chest</th>
                <th class="tw-px-4 tw-py-3 tw-text-left tw-font-medium tw-text-velox-700">Waist</th>
                <th class="tw-px-4 tw-py-3 tw-text-left tw-font-medium tw-text-velox-700">Hips</th>
              </tr>
            </thead>
            <tbody>
              {% if block.settings.size_xs != blank %}
              <tr class="tw-border-b tw-border-velox-100">
                <td class="tw-px-4 tw-py-3 tw-font-medium">XS</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.size_xs }}</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.waist_xs }}</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.hips_xs }}</td>
              </tr>
              {% endif %}
              {% if block.settings.size_s != blank %}
              <tr class="tw-border-b tw-border-velox-100">
                <td class="tw-px-4 tw-py-3 tw-font-medium">S</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.size_s }}</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.waist_s }}</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.hips_s }}</td>
              </tr>
              {% endif %}
              {% if block.settings.size_m != blank %}
              <tr class="tw-border-b tw-border-velox-100">
                <td class="tw-px-4 tw-py-3 tw-font-medium">M</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.size_m }}</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.waist_m }}</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.hips_m }}</td>
              </tr>
              {% endif %}
              {% if block.settings.size_l != blank %}
              <tr class="tw-border-b tw-border-velox-100">
                <td class="tw-px-4 tw-py-3 tw-font-medium">L</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.size_l }}</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.waist_l }}</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.hips_l }}</td>
              </tr>
              {% endif %}
              {% if block.settings.size_xl != blank %}
              <tr class="tw-border-b tw-border-velox-100">
                <td class="tw-px-4 tw-py-3 tw-font-medium">XL</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.size_xl }}</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.waist_xl }}</td>
                <td class="tw-px-4 tw-py-3">{{ block.settings.hips_xl }}</td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>

        {%- comment -%} Measurement tips {%- endcomment -%}
        {% if block.settings.measurement_tips != blank %}
          <div class="tw-mt-6 tw-p-4 tw-bg-velox-50 tw-rounded-lg">
            <h3 class="tw-font-medium tw-text-velox-900 tw-mb-2">How to Measure</h3>
            <div class="tw-text-sm tw-text-velox-600">
              {{ block.settings.measurement_tips }}
            </div>
          </div>
        {% endif %}
      {% endif %}
    </div>
  </div>
</div>

<script>
(function() {
  const trigger = document.querySelector('[data-size-chart-trigger]');
  const modal = document.querySelector('[data-size-chart-modal]');
  const closeBtn = document.querySelector('[data-size-chart-close]');
  const overlay = document.querySelector('[data-size-chart-overlay]');

  if (!trigger || !modal) return;

  function openModal() {
    modal.classList.remove('tw-hidden');
    document.body.style.overflow = 'hidden';
  }

  function closeModal() {
    modal.classList.add('tw-hidden');
    document.body.style.overflow = '';
  }

  trigger.addEventListener('click', openModal);
  closeBtn?.addEventListener('click', closeModal);
  overlay?.addEventListener('click', closeModal);

  // Escape to close
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !modal.classList.contains('tw-hidden')) {
      closeModal();
    }
  });
})();
</script>
