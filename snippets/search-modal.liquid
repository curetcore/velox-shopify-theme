{% comment %}
  Velox Search Modal
  Modal de búsqueda con predictive search.

  Uso:
  {% render 'search-modal' %}
{% endcomment %}

{%- comment -%} Overlay {%- endcomment -%}
<div
  id="search-overlay"
  class="tw-fixed tw-inset-0 tw-bg-black/50 tw-z-40 tw-opacity-0 tw-invisible tw-transition-all tw-duration-300"
  data-search-overlay
  aria-hidden="true"
></div>

{%- comment -%} Search modal {%- endcomment -%}
<div
  id="search-modal"
  class="tw-fixed tw-inset-x-0 tw-top-0 tw-z-50 tw-transform tw--translate-y-full tw-transition-transform tw-duration-300 tw-ease-in-out"
  data-search-modal
  role="dialog"
  aria-modal="true"
  aria-label="{{ 'general.search.search' | t | default: 'Buscar' }}"
>
  <div class="tw-bg-white tw-shadow-lg">
    <div class="tw-max-w-3xl tw-mx-auto tw-px-4 sm:tw-px-6 lg:tw-px-8 tw-py-6">
      {%- comment -%} Search form {%- endcomment -%}
      <form
        action="{{ routes.search_url }}"
        method="get"
        role="search"
        class="tw-relative"
        data-predictive-search-form
      >
        <input type="hidden" name="type" value="product">
        <input type="hidden" name="options[prefix]" value="last">

        <div class="tw-relative">
          {% render 'icon', name: 'search', class: 'tw-absolute tw-left-4 tw-top-1/2 tw--translate-y-1/2 tw-w-5 tw-h-5 tw-text-velox-400' %}

          <input
            type="search"
            name="q"
            id="search-input"
            class="tw-w-full tw-pl-12 tw-pr-12 tw-py-4 tw-text-lg tw-border tw-border-velox-200 tw-rounded-lg focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-velox-900 focus:tw-border-transparent tw-placeholder-velox-400"
            placeholder="{{ 'general.search.placeholder' | t | default: 'Buscar productos...' }}"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
            spellcheck="false"
            data-predictive-search-input
          >

          <button
            type="button"
            class="tw-absolute tw-right-3 tw-top-1/2 tw--translate-y-1/2 tw-p-1 tw-text-velox-400 hover:tw-text-velox-600 tw-transition-colors"
            data-search-close
            aria-label="{{ 'general.accessibility.close' | t | default: 'Cerrar' }}"
          >
            {% render 'icon', name: 'x', class: 'tw-w-6 tw-h-6' %}
          </button>
        </div>
      </form>

      {%- comment -%} Predictive search results {%- endcomment -%}
      <div
        id="predictive-search-results"
        class="tw-mt-4 tw-hidden"
        data-predictive-search-results
        role="listbox"
      >
        {%- comment -%} Loading state {%- endcomment -%}
        <div class="tw-hidden tw-py-8 tw-text-center" data-loading>
          <svg class="tw-animate-spin tw-h-6 tw-w-6 tw-mx-auto tw-text-velox-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="tw-opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="tw-opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <p class="tw-mt-2 tw-text-sm tw-text-velox-500">{{ 'general.search.loading' | t | default: 'Buscando...' }}</p>
        </div>

        {%- comment -%} Results container {%- endcomment -%}
        <div data-results-container></div>

        {%- comment -%} No results {%- endcomment -%}
        <div class="tw-hidden tw-py-8 tw-text-center" data-no-results>
          <p class="tw-text-velox-500">{{ 'general.search.no_results' | t | default: 'No se encontraron resultados' }}</p>
        </div>
      </div>

      {%- comment -%} Quick links / Popular searches {%- endcomment -%}
      {% assign show_popular = settings.show_popular_searches | default: true %}
      {% if show_popular %}
        {% assign popular_1 = settings.popular_search_1 | default: 'Sneakers' %}
        {% assign popular_2 = settings.popular_search_2 | default: 'Boots' %}
        {% assign popular_3 = settings.popular_search_3 | default: 'Sandals' %}
        {% assign popular_4 = settings.popular_search_4 | default: 'Sale' %}

        <div class="tw-mt-6 tw-pt-6 tw-border-t tw-border-velox-100" data-quick-links>
          <p class="tw-text-xs tw-font-medium tw-text-velox-500 tw-uppercase tw-tracking-wide tw-mb-3">
            {{ 'general.search.popular' | t | default: 'Búsquedas populares' }}
          </p>
          <div class="tw-flex tw-flex-wrap tw-gap-2">
            {% if popular_1 != blank %}
              <a
                href="{{ routes.search_url }}?q={{ popular_1 | url_encode }}&type=product"
                class="tw-inline-flex tw-px-3 tw-py-1.5 tw-text-sm tw-bg-velox-100 tw-text-velox-700 tw-rounded-full hover:tw-bg-velox-200 tw-transition-colors"
              >
                {{ popular_1 }}
              </a>
            {% endif %}
            {% if popular_2 != blank %}
              <a
                href="{{ routes.search_url }}?q={{ popular_2 | url_encode }}&type=product"
                class="tw-inline-flex tw-px-3 tw-py-1.5 tw-text-sm tw-bg-velox-100 tw-text-velox-700 tw-rounded-full hover:tw-bg-velox-200 tw-transition-colors"
              >
                {{ popular_2 }}
              </a>
            {% endif %}
            {% if popular_3 != blank %}
              <a
                href="{{ routes.search_url }}?q={{ popular_3 | url_encode }}&type=product"
                class="tw-inline-flex tw-px-3 tw-py-1.5 tw-text-sm tw-bg-velox-100 tw-text-velox-700 tw-rounded-full hover:tw-bg-velox-200 tw-transition-colors"
              >
                {{ popular_3 }}
              </a>
            {% endif %}
            {% if popular_4 != blank %}
              <a
                href="{{ routes.search_url }}?q={{ popular_4 | url_encode }}&type=product"
                class="tw-inline-flex tw-px-3 tw-py-1.5 tw-text-sm tw-bg-velox-100 tw-text-velox-700 tw-rounded-full hover:tw-bg-velox-200 tw-transition-colors"
              >
                {{ popular_4 }}
              </a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>

{%- comment -%} Search result item template (for JS) {%- endcomment -%}
<template id="search-result-template">
  <a href="" class="tw-flex tw-items-center tw-gap-4 tw-p-3 tw-rounded-lg hover:tw-bg-velox-50 tw-transition-colors" data-result-item>
    <div class="tw-w-16 tw-h-16 tw-bg-velox-100 tw-rounded-md tw-overflow-hidden tw-flex-shrink-0">
      <img src="" alt="" width="64" height="64" class="tw-w-full tw-h-full tw-object-cover" data-result-image>
    </div>
    <div class="tw-flex-1 tw-min-w-0">
      <p class="tw-text-sm tw-font-medium tw-text-velox-900 tw-truncate" data-result-title></p>
      <p class="tw-text-sm tw-text-velox-500" data-result-price></p>
    </div>
  </a>
</template>
