{% comment %}
  Velox 404 Page Section

  Página de error mejorada con múltiples estilos,
  colecciones populares, búsqueda y opciones de navegación.
{% endcomment %}

{%- liquid
  assign layout = section.settings.layout
  assign show_code = section.settings.show_error_code
  assign show_search = section.settings.show_search
  assign show_collections = section.settings.show_collections
  assign show_contact = section.settings.show_contact_link
  assign bg_color = section.settings.background_color

  # Background color classes
  case bg_color
    when 'dark'
      assign bg_class = 'tw-bg-velox-900'
      assign text_class = 'tw-text-white'
      assign text_muted_class = 'tw-text-velox-300'
      assign code_class = 'tw-text-velox-accent'
      assign input_bg = 'tw-bg-white/10'
      assign input_border = 'tw-border-white/20'
      assign input_text = 'tw-text-white'
    when 'light'
      assign bg_class = 'tw-bg-velox-50'
      assign text_class = 'tw-text-velox-900'
      assign text_muted_class = 'tw-text-velox-600'
      assign code_class = 'tw-text-velox-accent'
      assign input_bg = 'tw-bg-white'
      assign input_border = 'tw-border-velox-300'
      assign input_text = 'tw-text-velox-900'
    else
      assign bg_class = 'tw-bg-white'
      assign text_class = 'tw-text-velox-900'
      assign text_muted_class = 'tw-text-velox-600'
      assign code_class = 'tw-text-velox-accent'
      assign input_bg = 'tw-bg-velox-50'
      assign input_border = 'tw-border-velox-300'
      assign input_text = 'tw-text-velox-900'
  endcase
-%}

<section
  class="{{ bg_class }} tw-relative tw-isolate tw-min-h-[60vh] tw-flex tw-items-center"
  style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;"
  {{ section.shopify_attributes }}
>
  {%- comment -%} Background decoration {%- endcomment -%}
  {% if section.settings.show_decoration and bg_color == 'dark' %}
    <div aria-hidden="true" class="tw-absolute tw-inset-0 tw-overflow-hidden">
      <div class="tw-absolute tw--left-1/4 tw-top-0 tw-h-96 tw-w-1/2 tw-bg-gradient-to-r tw-from-velox-accent/20 tw-to-transparent tw-blur-3xl"></div>
      <div class="tw-absolute tw--right-1/4 tw-bottom-0 tw-h-96 tw-w-1/2 tw-bg-gradient-to-l tw-from-velox-accent/20 tw-to-transparent tw-blur-3xl"></div>
    </div>
  {% endif %}

  {%- comment -%} Background image {%- endcomment -%}
  {% if section.settings.background_image != blank %}
    <div class="tw-absolute tw-inset-0">
      {{ section.settings.background_image | image_url: width: 1920 | image_tag:
        class: 'tw-h-full tw-w-full tw-object-cover',
        loading: 'eager'
      }}
      <div class="tw-absolute tw-inset-0 tw-bg-velox-900/70"></div>
    </div>
  {% endif %}

  <div class="tw-relative tw-mx-auto tw-w-full tw-max-w-7xl tw-px-4 sm:tw-px-6 lg:tw-px-8">
    {% if layout == 'split' and section.settings.side_image != blank %}
      {%- comment -%} Layout dividido con imagen {%- endcomment -%}
      <div class="lg:tw-grid lg:tw-grid-cols-2 lg:tw-gap-x-16 lg:tw-items-center">
        <div class="tw-text-center lg:tw-text-left">
          {% render '404-content',
            show_code: show_code,
            text_class: text_class,
            text_muted_class: text_muted_class,
            code_class: code_class,
            show_search: show_search,
            input_bg: input_bg,
            input_border: input_border,
            input_text: input_text,
            show_contact: show_contact,
            section: section
          %}
        </div>
        <div class="tw-mt-12 lg:tw-mt-0">
          {{ section.settings.side_image | image_url: width: 800 | image_tag:
            class: 'tw-mx-auto tw-w-full tw-max-w-md tw-rounded-2xl tw-shadow-2xl',
            loading: 'eager'
          }}
        </div>
      </div>
    {% else %}
      {%- comment -%} Layout centrado (default) {%- endcomment -%}
      <div class="tw-mx-auto tw-max-w-2xl tw-text-center">
        {% render '404-content',
          show_code: show_code,
          text_class: text_class,
          text_muted_class: text_muted_class,
          code_class: code_class,
          show_search: show_search,
          input_bg: input_bg,
          input_border: input_border,
          input_text: input_text,
          show_contact: show_contact,
          section: section
        %}
      </div>
    {% endif %}

    {%- comment -%} Colecciones populares {%- endcomment -%}
    {% if show_collections %}
      <div class="tw-mt-16 tw-border-t {% if bg_color == 'dark' %}tw-border-white/10{% else %}tw-border-velox-200{% endif %} tw-pt-12">
        <h2 class="tw-text-center tw-text-lg tw-font-semibold {{ text_class }}">
          {{ 'search.popular_collections' | t }}
        </h2>

        <div class="tw-mt-8 tw-grid tw-grid-cols-2 tw-gap-4 sm:tw-grid-cols-3 md:tw-grid-cols-4 lg:tw-grid-cols-6">
          {% for block in section.blocks %}
            {% if block.type == 'collection' and block.settings.collection != blank %}
              {% assign collection = block.settings.collection %}
              <a
                href="{{ collection.url }}"
                class="tw-group tw-relative tw-aspect-square tw-overflow-hidden tw-rounded-xl tw-bg-velox-100"
                {{ block.shopify_attributes }}
              >
                {% if collection.featured_image != blank %}
                  {{ collection.featured_image | image_url: width: 400 | image_tag:
                    class: 'tw-h-full tw-w-full tw-object-cover tw-transition-transform tw-duration-300 group-hover:tw-scale-110',
                    loading: 'lazy'
                  }}
                {% else %}
                  <div class="tw-flex tw-h-full tw-w-full tw-items-center tw-justify-center tw-bg-velox-200">
                    {% render 'icon', name: 'photo', class: 'tw-h-12 tw-w-12 tw-text-velox-400' %}
                  </div>
                {% endif %}
                <div class="tw-absolute tw-inset-0 tw-bg-gradient-to-t tw-from-velox-900/80 tw-via-transparent tw-to-transparent"></div>
                <div class="tw-absolute tw-inset-x-0 tw-bottom-0 tw-p-3">
                  <p class="tw-text-sm tw-font-medium tw-text-white tw-truncate">
                    {{ collection.title }}
                  </p>
                </div>
              </a>
            {% endif %}
          {% endfor %}

          {%- comment -%} Placeholder si no hay colecciones {%- endcomment -%}
          {% if section.blocks.size == 0 %}
            {% for i in (1..6) %}
              <div class="tw-aspect-square tw-rounded-xl tw-bg-velox-100 tw-flex tw-items-center tw-justify-center">
                {% render 'icon', name: 'photo', class: 'tw-h-10 tw-w-10 tw-text-velox-300' %}
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "404 page",
  "tag": "section",
  "class": "section-404",
  "settings": [
    {
      "type": "select",
      "id": "layout",
      "label": "Diseño",
      "options": [
        { "value": "centered", "label": "Centrado" },
        { "value": "split", "label": "Dividido con imagen" }
      ],
      "default": "centered"
    },
    {
      "type": "header",
      "content": "Contenido"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Título",
      "default": "Página no encontrada"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Descripción",
      "default": "Lo sentimos, la página que buscas no existe o ha sido movida."
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Texto del botón principal",
      "default": "Volver al inicio"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Enlace del botón",
      "default": "/"
    },
    {
      "type": "checkbox",
      "id": "show_error_code",
      "label": "Mostrar código 404",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Mostrar campo de búsqueda",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_contact_link",
      "label": "Mostrar enlace de contacto",
      "default": true
    },
    {
      "type": "header",
      "content": "Colecciones"
    },
    {
      "type": "checkbox",
      "id": "show_collections",
      "label": "Mostrar colecciones populares",
      "default": true,
      "info": "Agrega colecciones usando los bloques"
    },
    {
      "type": "header",
      "content": "Imágenes"
    },
    {
      "type": "image_picker",
      "id": "side_image",
      "label": "Imagen lateral",
      "info": "Solo para diseño dividido"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Imagen de fondo"
    },
    {
      "type": "header",
      "content": "Estilo"
    },
    {
      "type": "select",
      "id": "background_color",
      "label": "Color de fondo",
      "options": [
        { "value": "white", "label": "Blanco" },
        { "value": "light", "label": "Gris claro" },
        { "value": "dark", "label": "Oscuro" }
      ],
      "default": "dark"
    },
    {
      "type": "checkbox",
      "id": "show_decoration",
      "label": "Mostrar decoración de fondo",
      "default": true,
      "info": "Solo visible en modo oscuro"
    },
    {
      "type": "header",
      "content": "Espaciado"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding superior",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 64
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding inferior",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 64
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Colección",
      "limit": 6,
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Colección"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "404 page",
      "settings": {
        "layout": "centered",
        "background_color": "dark",
        "show_collections": true
      },
      "blocks": []
    }
  ]
}
{% endschema %}
