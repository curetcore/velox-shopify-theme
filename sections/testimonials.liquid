{% comment %}
  Velox Testimonials Section
  Muestra testimonios de clientes con foto, nombre y reseña.
{% endcomment %}

<section class="tw-py-12 md:tw-py-16 lg:tw-py-20 {% if section.settings.background_color == 'secondary' %}tw-bg-velox-50{% endif %}">
  <div class="tw-max-w-7xl tw-mx-auto tw-px-4 sm:tw-px-6 lg:tw-px-8">
    {%- comment -%} Header de la sección {%- endcomment -%}
    {% if section.settings.title != blank or section.settings.description != blank %}
      <div class="tw-text-center tw-mb-12">
        {% if section.settings.eyebrow != blank %}
          <p class="tw-text-sm tw-font-semibold tw-uppercase tw-tracking-wider tw-text-velox-accent tw-mb-3">
            {{ section.settings.eyebrow }}
          </p>
        {% endif %}

        {% if section.settings.title != blank %}
          <h2 class="tw-text-2xl md:tw-text-3xl lg:tw-text-4xl tw-font-bold tw-text-velox-900">
            {{ section.settings.title }}
          </h2>
        {% endif %}

        {% if section.settings.description != blank %}
          <p class="tw-mt-4 tw-text-velox-600 tw-max-w-2xl tw-mx-auto">
            {{ section.settings.description }}
          </p>
        {% endif %}
      </div>
    {% endif %}

    {%- comment -%} Grid de testimonios {%- endcomment -%}
    {% if section.blocks.size > 0 %}
      <div class="tw-grid tw-grid-cols-1 md:tw-grid-cols-2 lg:tw-grid-cols-{{ section.settings.columns }} tw-gap-8">
        {% for block in section.blocks %}
          <div class="tw-bg-white tw-rounded-xl tw-p-6 lg:tw-p-8 tw-shadow-sm tw-border tw-border-velox-100" {{ block.shopify_attributes }}>
            {%- comment -%} Estrellas de rating {%- endcomment -%}
            {% if section.settings.show_rating %}
              <div class="tw-flex tw-items-center tw-gap-1 tw-mb-4">
                {% assign rating = block.settings.rating | default: 5 %}
                {% for i in (1..5) %}
                  {% if i <= rating %}
                    {% render 'icon', name: 'star-filled', class: 'tw-w-5 tw-h-5 tw-text-yellow-400' %}
                  {% else %}
                    {% render 'icon', name: 'star', class: 'tw-w-5 tw-h-5 tw-text-velox-200' %}
                  {% endif %}
                {% endfor %}
              </div>
            {% endif %}

            {%- comment -%} Quote/texto del testimonio {%- endcomment -%}
            {% if block.settings.quote != blank %}
              <blockquote class="tw-text-velox-700 tw-leading-relaxed tw-mb-6">
                "{{ block.settings.quote }}"
              </blockquote>
            {% endif %}

            {%- comment -%} Autor {%- endcomment -%}
            <div class="tw-flex tw-items-center tw-gap-4">
              {% if block.settings.image != blank %}
                <div class="tw-flex-shrink-0">
                  {{ block.settings.image | image_url: width: 96 | image_tag:
                    class: 'tw-w-12 tw-h-12 tw-rounded-full tw-object-cover',
                    loading: 'lazy'
                  }}
                </div>
              {% else %}
                <div class="tw-flex-shrink-0 tw-w-12 tw-h-12 tw-rounded-full tw-bg-velox-100 tw-flex tw-items-center tw-justify-center">
                  {% render 'icon', name: 'user', class: 'tw-w-6 tw-h-6 tw-text-velox-400' %}
                </div>
              {% endif %}

              <div>
                {% if block.settings.author != blank %}
                  <p class="tw-font-semibold tw-text-velox-900">{{ block.settings.author }}</p>
                {% endif %}
                {% if block.settings.title != blank %}
                  <p class="tw-text-sm tw-text-velox-500">{{ block.settings.title }}</p>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      {%- comment -%} Placeholder {%- endcomment -%}
      <div class="tw-grid tw-grid-cols-1 md:tw-grid-cols-3 tw-gap-8">
        {% for i in (1..3) %}
          <div class="tw-bg-white tw-rounded-xl tw-p-6 tw-shadow-sm tw-border tw-border-velox-100">
            <div class="tw-flex tw-gap-1 tw-mb-4">
              {% for j in (1..5) %}
                <div class="tw-w-5 tw-h-5 tw-bg-velox-100 tw-rounded"></div>
              {% endfor %}
            </div>
            <div class="tw-h-4 tw-bg-velox-100 tw-rounded tw-w-full tw-mb-2"></div>
            <div class="tw-h-4 tw-bg-velox-100 tw-rounded tw-w-5/6 tw-mb-2"></div>
            <div class="tw-h-4 tw-bg-velox-100 tw-rounded tw-w-4/6 tw-mb-6"></div>
            <div class="tw-flex tw-items-center tw-gap-4">
              <div class="tw-w-12 tw-h-12 tw-rounded-full tw-bg-velox-100"></div>
              <div>
                <div class="tw-h-4 tw-bg-velox-100 tw-rounded tw-w-24 tw-mb-1"></div>
                <div class="tw-h-3 tw-bg-velox-100 tw-rounded tw-w-16"></div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <p class="tw-text-center tw-text-velox-500 tw-mt-8">
        Agrega testimonios usando el editor del tema.
      </p>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Testimonials",
  "tag": "section",
  "class": "velox-testimonials",
  "max_blocks": 6,
  "settings": [
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Texto superior",
      "default": "Testimonios"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Título",
      "default": "Lo que dicen nuestros clientes"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Descripción"
    },
    {
      "type": "range",
      "id": "columns",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 3,
      "label": "Columnas (desktop)"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Mostrar estrellas",
      "default": true
    },
    {
      "type": "select",
      "id": "background_color",
      "label": "Color de fondo",
      "options": [
        { "value": "transparent", "label": "Transparente" },
        { "value": "secondary", "label": "Secundario" }
      ],
      "default": "secondary"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonio",
      "settings": [
        {
          "type": "textarea",
          "id": "quote",
          "label": "Texto del testimonio",
          "default": "Excelente calidad y servicio. Los zapatos son súper cómodos y llegaron rápidamente. Definitivamente volveré a comprar."
        },
        {
          "type": "range",
          "id": "rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5,
          "label": "Calificación"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Foto del cliente"
        },
        {
          "type": "text",
          "id": "author",
          "label": "Nombre",
          "default": "María García"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Título/ubicación",
          "default": "Cliente verificado"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "category": "Social",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "quote": "Los mejores zapatos que he comprado. La calidad es increíble y el diseño es perfecto.",
            "author": "María García",
            "title": "Cliente verificado",
            "rating": 5
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "quote": "Excelente atención al cliente y envío súper rápido. Muy recomendado.",
            "author": "Carlos López",
            "title": "Compra verificada",
            "rating": 5
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "quote": "Increíble comodidad desde el primer día. No necesitan periodo de adaptación.",
            "author": "Ana Martínez",
            "title": "Cliente frecuente",
            "rating": 5
          }
        }
      ]
    }
  ]
}
{% endschema %}
