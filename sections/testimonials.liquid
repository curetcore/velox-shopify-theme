{% comment %}
  Testimonials Carousel
  Inspired by Shrine Pro

  Carousel de testimonios con avatar, nombre, rating, y texto.
  Usa Splide.js para el carrusel.
{% endcomment %}

<section 
  class="testimonials-section tw-py-12 lg:tw-py-20 {% if section.settings.background == 'secondary' %}tw-bg-velox-50{% endif %}"
  data-section-id="{{ section.id }}"
  data-animate="fade-up"
>
  <div class="tw-max-w-7xl tw-mx-auto tw-px-4">
    {%- comment -%} Header {%- endcomment -%}
    {% if section.settings.heading != blank or section.settings.subheading != blank %}
      <div class="tw-text-center tw-mb-10">
        {% if section.settings.subheading != blank %}
          <p class="tw-text-sm tw-font-medium tw-text-accent tw-uppercase tw-tracking-wider tw-mb-2">
            {{ section.settings.subheading }}
          </p>
        {% endif %}
        {% if section.settings.heading != blank %}
          <h2 class="tw-text-3xl lg:tw-text-4xl tw-font-bold tw-text-velox-900">
            {{ section.settings.heading }}
          </h2>
        {% endif %}
      </div>
    {% endif %}

    {%- comment -%} Carousel {%- endcomment -%}
    <div 
      class="splide testimonials-carousel" 
      data-testimonials-carousel
      aria-label="Testimonios de clientes"
    >
      <div class="splide__track">
        <ul class="splide__list">
          {% for block in section.blocks %}
            {% if block.type == 'testimonial' %}
              <li class="splide__slide tw-px-2" {{ block.shopify_attributes }}>
                <div class="tw-bg-white tw-rounded-xl tw-p-6 tw-shadow-sm tw-border tw-border-velox-100 tw-h-full tw-flex tw-flex-col">
                  {%- comment -%} Rating {%- endcomment -%}
                  {% if block.settings.rating > 0 %}
                    <div class="tw-flex tw-gap-1 tw-mb-4">
                      {% for i in (1..5) %}
                        {% if i <= block.settings.rating %}
                          <svg class="tw-w-5 tw-h-5 tw-text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                          </svg>
                        {% else %}
                          <svg class="tw-w-5 tw-h-5 tw-text-velox-200" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                          </svg>
                        {% endif %}
                      {% endfor %}
                    </div>
                  {% endif %}

                  {%- comment -%} Testimonial Text {%- endcomment -%}
                  {% if block.settings.text != blank %}
                    <blockquote class="tw-text-velox-600 tw-flex-1 tw-mb-4">
                      "{{ block.settings.text }}"
                    </blockquote>
                  {% endif %}

                  {%- comment -%} Author {%- endcomment -%}
                  <div class="tw-flex tw-items-center tw-gap-3 tw-mt-auto tw-pt-4 tw-border-t tw-border-velox-100">
                    {% if block.settings.avatar != blank %}
                      <div class="tw-w-10 tw-h-10 tw-rounded-full tw-overflow-hidden tw-bg-velox-100">
                        {{ block.settings.avatar | image_url: width: 80 | image_tag: 
                          class: 'tw-w-full tw-h-full tw-object-cover',
                          loading: 'lazy'
                        }}
                      </div>
                    {% else %}
                      <div class="tw-w-10 tw-h-10 tw-rounded-full tw-bg-accent/10 tw-flex tw-items-center tw-justify-center tw-text-accent tw-font-semibold">
                        {{ block.settings.name | slice: 0 | upcase }}
                      </div>
                    {% endif %}
                    <div>
                      <p class="tw-font-medium tw-text-velox-900">{{ block.settings.name }}</p>
                      {% if block.settings.title != blank %}
                        <p class="tw-text-xs tw-text-velox-500">{{ block.settings.title }}</p>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>

      {%- comment -%} Pagination Dots {%- endcomment -%}
      {% if section.settings.show_pagination %}
        <ul class="splide__pagination tw-flex tw-justify-center tw-gap-2 tw-mt-6"></ul>
      {% endif %}
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('[data-testimonials-carousel]');
    if (!carousel || typeof Splide === 'undefined') return;

    new Splide(carousel, {
      type: '{{ section.settings.carousel_type }}',
      perPage: {{ section.settings.per_page }},
      perMove: 1,
      gap: '1rem',
      padding: { left: 0, right: '2rem' },
      pagination: {{ section.settings.show_pagination }},
      arrows: {{ section.settings.show_arrows }},
      autoplay: {{ section.settings.autoplay }},
      interval: {{ section.settings.autoplay_speed | times: 1000 }},
      pauseOnHover: true,
      breakpoints: {
        1024: { perPage: 2 },
        640: { perPage: 1 }
      }
    }).mount();
  });
</script>

{% schema %}
{
  "name": "Testimonials",
  "tag": "section",
  "class": "testimonials-section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "What Our Customers Say"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Testimonials"
    },
    {
      "type": "select",
      "id": "background",
      "label": "Background",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "secondary", "label": "Secondary" }
      ],
      "default": "default"
    },
    {
      "type": "header",
      "content": "Carousel Settings"
    },
    {
      "type": "select",
      "id": "carousel_type",
      "label": "Carousel type",
      "options": [
        { "value": "slide", "label": "Slide" },
        { "value": "loop", "label": "Loop" }
      ],
      "default": "loop"
    },
    {
      "type": "range",
      "id": "per_page",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 3,
      "label": "Testimonials per page"
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "default": true,
      "label": "Show navigation arrows"
    },
    {
      "type": "checkbox",
      "id": "show_pagination",
      "default": true,
      "label": "Show pagination dots"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "default": false,
      "label": "Enable autoplay"
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "default": 5,
      "unit": "s",
      "label": "Autoplay speed"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "image_picker",
          "id": "avatar",
          "label": "Avatar"
        },
        {
          "type": "text",
          "id": "name",
          "default": "John Doe",
          "label": "Name"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title (optional)",
          "info": "e.g. 'Verified Buyer'"
        },
        {
          "type": "range",
          "id": "rating",
          "min": 0,
          "max": 5,
          "step": 1,
          "default": 5,
          "label": "Rating"
        },
        {
          "type": "textarea",
          "id": "text",
          "default": "This product exceeded my expectations. Great quality and fast shipping!",
          "label": "Testimonial text"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "name": "Sarah M.",
            "title": "Verified Buyer",
            "rating": 5,
            "text": "Absolutely love this product! The quality is amazing and it arrived faster than expected."
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "name": "Mike T.",
            "title": "Verified Buyer",
            "rating": 5,
            "text": "Best purchase I've made in a long time. Highly recommend to anyone looking for quality."
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "name": "Emily R.",
            "title": "Verified Buyer",
            "rating": 4,
            "text": "Great product, excellent customer service. Will definitely be ordering again!"
          }
        }
      ]
    }
  ]
}
{% endschema %}
