{% comment %}
  Velox FAQ Section

  Sección de preguntas frecuentes con acordeón expandible.
  Usa <details>/<summary> para máxima accesibilidad.
{% endcomment %}

{%- liquid
  assign layout = section.settings.layout
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading
  assign show_contact_link = section.settings.show_contact_link
  assign contact_text = section.settings.contact_text
  assign contact_url = section.settings.contact_url
  assign bg_color = section.settings.background_color

  # Background color class
  case bg_color
    when 'white'
      assign bg_class = 'tw-bg-white'
    when 'light'
      assign bg_class = 'tw-bg-velox-50'
    when 'dark'
      assign bg_class = 'tw-bg-velox-900'
      assign text_class = 'tw-text-white'
      assign text_muted_class = 'tw-text-velox-300'
      assign border_class = 'tw-border-velox-700'
    else
      assign bg_class = 'tw-bg-white'
  endcase

  assign text_class = text_class | default: 'tw-text-velox-900'
  assign text_muted_class = text_muted_class | default: 'tw-text-velox-600'
  assign border_class = border_class | default: 'tw-border-velox-200'
-%}

<section
  class="{{ bg_class }}"
  style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;"
  {{ section.shopify_attributes }}
>
  <div class="tw-mx-auto tw-max-w-7xl tw-px-4 sm:tw-px-6 lg:tw-px-8">
    {% if layout == 'two-column' %}
      {%- comment -%} Layout dos columnas {%- endcomment -%}
      <div class="lg:tw-grid lg:tw-grid-cols-12 lg:tw-gap-8">
        {%- comment -%} Columna izquierda: Header {%- endcomment -%}
        <div class="lg:tw-col-span-5">
          {% if heading != blank %}
            <h2 class="tw-text-3xl tw-font-bold tw-tracking-tight {{ text_class }}">
              {{ heading }}
            </h2>
          {% endif %}

          {% if subheading != blank %}
            <p class="tw-mt-4 tw-text-base {{ text_muted_class }}">
              {{ subheading }}
            </p>
          {% endif %}

          {% if show_contact_link and contact_url != blank %}
            <p class="tw-mt-4 tw-text-base {{ text_muted_class }}">
              {{ contact_text | default: '¿No encuentras lo que buscas?' }}
              <a href="{{ contact_url }}" class="tw-font-semibold tw-text-velox-accent hover:tw-text-velox-accent/80 tw-transition-colors">
                {{ 'pages.contact.title' | t }}
              </a>
            </p>
          {% endif %}
        </div>

        {%- comment -%} Columna derecha: FAQs {%- endcomment -%}
        <div class="tw-mt-10 lg:tw-col-span-7 lg:tw-mt-0">
          {% if section.blocks.size > 0 %}
            <dl class="tw-space-y-6 tw-divide-y {{ border_class }}">
              {% for block in section.blocks %}
                {% render 'faq-item',
                  block: block,
                  text_class: text_class,
                  text_muted_class: text_muted_class,
                  border_class: border_class,
                  index: forloop.index
                %}
              {% endfor %}
            </dl>
          {% else %}
            <p class="{{ text_muted_class }} tw-text-center tw-py-8">
              {{ 'sections.faq.placeholder' | t }}
            </p>
          {% endif %}
        </div>
      </div>
    {% else %}
      {%- comment -%} Layout centrado {%- endcomment -%}
      <div class="tw-mx-auto tw-max-w-3xl">
        {%- comment -%} Header {%- endcomment -%}
        <div class="tw-text-center tw-mb-12">
          {% if heading != blank %}
            <h2 class="tw-text-3xl tw-font-bold tw-tracking-tight {{ text_class }}">
              {{ heading }}
            </h2>
          {% endif %}

          {% if subheading != blank %}
            <p class="tw-mt-4 tw-text-lg {{ text_muted_class }}">
              {{ subheading }}
            </p>
          {% endif %}
        </div>

        {%- comment -%} FAQs {%- endcomment -%}
        {% if section.blocks.size > 0 %}
          <dl class="tw-space-y-4">
            {% for block in section.blocks %}
              {% render 'faq-item',
                block: block,
                text_class: text_class,
                text_muted_class: text_muted_class,
                border_class: border_class,
                index: forloop.index,
                style: 'card'
              %}
            {% endfor %}
          </dl>
        {% else %}
          <p class="{{ text_muted_class }} tw-text-center tw-py-8">
            {{ 'sections.faq.placeholder' | t }}
          </p>
        {% endif %}

        {%- comment -%} Contact link {%- endcomment -%}
        {% if show_contact_link and contact_url != blank %}
          <div class="tw-mt-10 tw-text-center">
            <p class="{{ text_muted_class }}">
              {{ contact_text | default: '¿No encuentras lo que buscas?' }}
            </p>
            <a
              href="{{ contact_url }}"
              class="tw-mt-2 tw-inline-flex tw-items-center tw-gap-2 tw-font-semibold tw-text-velox-accent hover:tw-text-velox-accent/80 tw-transition-colors"
            >
              {{ 'pages.contact.title' | t }}
              {% render 'icon', name: 'arrow-right', class: 'tw-w-4 tw-h-4' %}
            </a>
          </div>
        {% endif %}
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "FAQ",
  "tag": "section",
  "class": "section-faq",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Titulo",
      "default": "Preguntas frecuentes"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subtitulo",
      "default": "Encuentra respuestas a las preguntas más comunes sobre nuestros productos y servicios."
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Diseño",
      "options": [
        { "value": "centered", "label": "Centrado" },
        { "value": "two-column", "label": "Dos columnas" }
      ],
      "default": "centered"
    },
    {
      "type": "select",
      "id": "background_color",
      "label": "Color de fondo",
      "options": [
        { "value": "white", "label": "Blanco" },
        { "value": "light", "label": "Gris claro" },
        { "value": "dark", "label": "Oscuro" }
      ],
      "default": "white"
    },
    {
      "type": "header",
      "content": "Enlace de contacto"
    },
    {
      "type": "checkbox",
      "id": "show_contact_link",
      "label": "Mostrar enlace de contacto",
      "default": true
    },
    {
      "type": "text",
      "id": "contact_text",
      "label": "Texto antes del enlace",
      "default": "¿No encuentras lo que buscas?"
    },
    {
      "type": "url",
      "id": "contact_url",
      "label": "URL de contacto"
    },
    {
      "type": "header",
      "content": "Espaciado"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding superior",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 64
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding inferior",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 64
    }
  ],
  "blocks": [
    {
      "type": "question",
      "name": "Pregunta",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Pregunta",
          "default": "¿Cuál es la pregunta?"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Respuesta",
          "default": "<p>Aquí va la respuesta a la pregunta.</p>"
        },
        {
          "type": "checkbox",
          "id": "open_by_default",
          "label": "Abrir por defecto",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "FAQ",
      "blocks": [
        {
          "type": "question",
          "settings": {
            "question": "¿Cuánto tarda el envío?",
            "answer": "<p>Los envíos estándar tardan entre 3-5 días hábiles. Los envíos express llegan en 1-2 días hábiles.</p>",
            "open_by_default": true
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "¿Puedo devolver un producto?",
            "answer": "<p>Sí, aceptamos devoluciones dentro de los 30 días posteriores a la compra. El producto debe estar en su estado original.</p>"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "¿Qué métodos de pago aceptan?",
            "answer": "<p>Aceptamos tarjetas de crédito y débito (Visa, MasterCard, American Express), PayPal, y transferencia bancaria.</p>"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "¿Cómo puedo rastrear mi pedido?",
            "answer": "<p>Una vez que tu pedido sea enviado, recibirás un email con el número de seguimiento y un enlace para rastrear tu paquete.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
